// Using theme variables instead of local variables

// Styles généraux
:host {
  display: block;
  margin: 0;
  margin-bottom: calc(var(--spacing-sm) + 35px);

  // Supprimer la marge quand le panneau avancé est ouvert
  &.advanced-open {
    margin-bottom: 0 !important;
  }

  ::ng-deep .mat-mdc-form-field-subscript-wrapper, .mat-mdc-form-field-bottom-align::before {
    display: none !important;
  }

  @media (max-width: 768px) {
    margin-bottom: calc(var(--spacing-sm) + 24px);

    &.advanced-open {
      margin-bottom: 0 !important;
    }
  }
}

.filters-container {
  width: 100%;
  font-family: var(--font-family-base);
  transition: all 0.4s ease;
  transform-origin: top;

  // Animation de masquage/affichage
  &.hidden {
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    transform: scaleY(0);
    margin-bottom: 0;
    pointer-events: none;
  }

  &:not(.hidden) {
    opacity: 1;
    max-height: 2000px; // Valeur élevée pour permettre l'expansion
    transform: scaleY(1);
  }
}

.filters-form {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

// Card design pour les filtres principaux
.filters-card {
  background-color: var(--surface);
  border-radius: var(--border-radius-medium);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  transition: var(--transition-medium);
  padding: var(--spacing-xl);

  &:hover {
    box-shadow: var(--shadow-md);
  }

}

// Style de la rangée principale des filtres
.filters-row {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--spacing-md);
  width: 100%;

  @media (max-width: 768px) {
    flex-direction: column;
    align-items: stretch;
    gap: var(--spacing-sm);

    .search-wrapper {
      margin-bottom: var(--spacing-sm);
    }
  }
}

// Conteneur pour les contrôles (sort + filtres avancés)
.controls-row {
  display: flex;
  gap: var(--spacing-sm);
  align-items: stretch;
  width: 100%;

  @media (min-width: 769px) {
    width: auto; // Sur desktop, ne pas prendre toute la largeur
  }

  @media (max-width: 768px) {
    .sort-wrapper {
      flex: 1;
      min-width: 0; // Permet au champ de se rétrécir si nécessaire
    }

    .advanced-filters-toggle {
      flex: 0 0 auto; // Garde sa taille naturelle
    }
  }
}

// Wrapper de la barre de recherche
.search-wrapper {
  flex: 1;
  min-width: 200px;

  .search-field {
    width: 100%;

    .search-icon {
      color: var(--primary);
      opacity: 0.7;
    }

    // Animation du label
    ::ng-deep .mat-mdc-form-field-flex {
      transition: var(--transition-fast);
      border-radius: var(--border-radius-small);

      &:hover {
        background-color: rgba(90, 72, 245, 0.03); // var(--primary) with 3% opacity
      }
    }

    // Ajustements pour mobile
    @media (max-width: 576px) {
      ::ng-deep .mat-mdc-form-field-infix {
        padding-top: 12px;
        padding-bottom: 12px;
      }

      ::ng-deep .mat-mdc-text-field-wrapper {
        padding-left: var(--spacing-sm);
        padding-right: var(--spacing-sm);
      }
    }
  }
}

// Style du sélecteur de tri
.sort-wrapper {
  width: 180px;

  @media (max-width: 768px) {
    width: 100%; // Prendre toute la place disponible dans le flex
    min-width: 120px; // Largeur minimale
  }

  .sort-select {
    width: 100%;

    ::ng-deep .mat-mdc-select-value {
      font-weight: 500; // Medium
    }

    ::ng-deep .mat-mdc-form-field-infix {
      width: auto;
    }

    // Suppression de la ligne de soulignement
    ::ng-deep .mdc-line-ripple {
      display: none;
    }

    // Correction des border-radius pour tous les coins
    ::ng-deep .mat-mdc-text-field-wrapper {
      border-radius: var(--border-radius-small) !important;
      border-top-left-radius: var(--border-radius-small) !important;
      border-top-right-radius: var(--border-radius-small) !important;
    }


    // Ajustements pour mobile
    @media (max-width: 576px) {

      ::ng-deep .mdc-floating-label {
        transform: translateY(-13px);
      }

      ::ng-deep .mdc-floating-label--float-above {
        display: none;
      }

      ::ng-deep .mat-mdc-form-field-infix {
        padding-top: 12px;
        padding-bottom: 12px;
      }

      ::ng-deep .mat-mdc-text-field-wrapper {
        padding-left: var(--spacing-sm);
        padding-right: var(--spacing-sm);
      }

      ::ng-deep .mat-mdc-form-field-flex {
        height: 48px;
      }

      ::ng-deep .mat-mdc-select-arrow-wrapper {
        transform: translateY(0);
      }
    }
  }

}

// Bouton des filtres avancés
.advanced-filters-toggle {
  height: 100%;
  display: flex;
  align-items: stretch;

  @media (max-width: 768px) {
    min-width: fit-content;
  }

  .advanced-filters-button {
    padding: 0 var(--spacing-md);
    height: 100%;
    min-height: 56px;
    transition: var(--transition-fast);
    box-shadow: var(--shadow-sm);
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    white-space: nowrap; // Empêcher le retour à la ligne du texte

    &.active {
      background-color: var(--primary-dark);
    }

    mat-icon {
      transition: transform var(--transition-fast);
    }

    @media (min-width: 768px) {
      &:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }
    }

    // Ajustements pour mobile
    @media (max-width: 576px) {
      min-height: 48px;
      padding: 0 var(--spacing-sm);
      font-size: 14px;

      mat-icon {
        font-size: 20px;
        width: 20px;
        height: 20px;
      }
    }
  }
}

// Section des catégories
.categories-section {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);

  .categories-label {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: 14px; // Body Small size
    font-weight: 500; // Medium
    color: var(--primary);
    letter-spacing: 0.1px; // From design guidelines

    mat-icon {
      font-size: 18px;
      width: 18px;
      height: 18px;
    }
  }

  .categories-chips-scroll {
    overflow-x: auto;
    padding-bottom: var(--spacing-xs); // Espace pour le scrollbar

    // Cacher la scrollbar mais garder la fonctionnalité
    &::-webkit-scrollbar {
      height: 4px;
    }

    &::-webkit-scrollbar-track {
      background: rgba(222, 226, 230, 0.3); // Light gray with 30% opacity
      border-radius: 10px;
    }

    &::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 10px;

      &:hover {
        background: var(--text-secondary);
      }
    }
  }

  .category-chip {
    border-radius: var(--border-radius-medium);
    transition: var(--transition-fast);
    font-size: 13px;
    height: 32px;
    letter-spacing: 0.25px;
    font-weight: 500;
    box-shadow: var(--shadow-sm);

    // Style par défaut amélioré
    &:not(.mat-mdc-chip-selected) {
      background-color: var(--surface);
      border: 1px solid var(--border);
    }

    &:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    // Style des chips sélectionnées - correction de l'espacement
    &.mat-mdc-chip-selected {
      background-color: var(--primary-light);
      color: var(--text-on-primary);
      position: relative;

      &::after {
        content: "";
        position: absolute;
        inset: 0; // Changé de -2px à 0 pour éliminer l'espace
        border-radius: var(--border-radius-medium);
        border: 1px solid var(--primary);
        pointer-events: none;
      }
    }

    // Ajustements pour mobile
    @media (max-width: 576px) {
      height: 28px;
      font-size: 12px;
      padding: 0 var(--spacing-sm);
    }
  }

}

// Panel de filtres avancés (Accordéon)
.advanced-filters-panel {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s cubic-bezier(0, 1, 0, 1);
  background-color: var(--surface);
  border-radius: var(--border-radius-medium);
  box-shadow: var(--shadow-sm);
  margin-top: -35px; // Chevauchement avec la carte principale

  &.open {
    max-height: 1000px; // Grande valeur pour permettre l'expansion
    transition: max-height 0.5s cubic-bezier(0.9, 0, 0.3, 1);
    margin-bottom: var(--spacing-md);
    padding-top: var(--spacing-md);
  }

  .advanced-filters-content {
    padding: var(--spacing-lg);
    padding-top: 0;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);

    @media (max-width: 576px) {
      padding: var(--spacing-md);
      padding-top: 0;
      gap: var(--spacing-md);
    }
  }

  .advanced-filters-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--border);

    h3 {
      margin: 0;
      color: var(--text-primary);
      font-size: 20px; // Heading 3 size
      font-weight: 600; // SemiBold
      letter-spacing: 0px; // From design guidelines

      @media (max-width: 576px) {
        font-size: 18px;
      }
    }

    .applied-filters-count {
      font-size: 12px; // Label size
      background-color: rgba(255, 170, 0, 0.1); // var(--accent) with 10% opacity
      color: var(--accent);
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: var(--border-radius-large);
      font-weight: 500; // Medium
      letter-spacing: 0.5px; // From design guidelines
    }

    @media (max-width: 576px) {
      padding-bottom: var(--spacing-sm);
    }
  }

  @media (max-width: 576px) {
    margin-top: -25px; // Réduire le chevauchement en mobile
  }
}

// Corps des filtres avancés
.advanced-filters-body {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-lg);
}

// Grille de filtres (pour date et lieu)
.filters-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: var(--spacing-lg);

  @media (max-width: 576px) {
    grid-template-columns: 1fr;
    gap: var(--spacing-md); // Réduire l'espace entre les éléments en mobile
  }
}

// Style commun pour les items de filtre
.filter-item {
  background-color: rgba(248, 249, 250, 0.5); // var(--background) with 50% opacity
  border-radius: var(--border-radius-medium);
  padding: var(--spacing-md);
  transition: var(--transition-fast);

  &:hover {
    background-color: var(--background);
  }

  .filter-item-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-md);

    mat-icon {
      color: var(--primary);
    }

    h4 {
      margin: 0;
      font-size: 16px; // Body Default size
      font-weight: 500; // Medium
      color: var(--text-primary);
      letter-spacing: 0px; // From design guidelines
    }
  }

  // Ajustements pour mobile
  @media (max-width: 576px) {
    padding: var(--spacing-sm);

    .filter-item-header {
      margin-bottom: var(--spacing-sm); // Réduire la marge en bas pour mobile
    }

    // Correction pour les champs de formulaire
    ::ng-deep .mat-mdc-form-field {
      .mat-mdc-form-field-infix {
        padding-top: 12px;
        padding-bottom: 12px;
      }

      // Empêcher le débordement du texte sur les icônes
      .mat-mdc-form-field-flex {
        align-items: center;
      }

      // Ajuster les icônes pour éviter le débordement
      .mat-icon {
        font-size: 20px;
        width: 20px;
        height: 20px;
        margin-right: var(--spacing-xs);
      }
    }
  }
}

// Grid pour les checkboxes de genres
.genres-filter {
  margin-top: var(--spacing-sm);

  .genres-grid {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-sm) var(--spacing-md);
    max-height: 180px;
    overflow-y: auto;
    padding-right: var(--spacing-sm);

    // Style du scrollbar
    &::-webkit-scrollbar {
      width: 5px;
    }

    &::-webkit-scrollbar-track {
      background: rgba(222, 226, 230, 0.3); // Light gray with 30% opacity
      border-radius: 10px;
    }

    &::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 10px;
    }

    .genre-checkbox {
      margin: 2px;
      width: fit-content;

      ::ng-deep .mdc-form-field {
        color: var(--text-primary);
      }

      ::ng-deep .mdc-checkbox .mdc-checkbox__native-control:checked ~ .mdc-checkbox__background {
        background-color: var(--accent);
        border-color: var(--accent);
      }
    }

    .no-genres {
      color: var(--text-secondary);
      font-style: italic;
      grid-column: 1 / -1;
      text-align: center;
      padding: var(--spacing-md);
    }
  }
}

// Boutons d'action pour les filtres avancés
.advanced-filters-actions {
  display: flex;
  justify-content: flex-end;
  gap: var(--spacing-md);
  margin-top: var(--spacing-sm);
  padding-top: var(--spacing-md);
  border-top: 1px solid var(--border);

  button {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    border-radius: var(--border-radius-medium);
    transition: var(--transition-fast);
    padding: 0 var(--spacing-md);
    font-size: 14px; // Button size
    font-weight: 500; // Medium
    letter-spacing: 0.25px; // From design guidelines

    &:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }

    mat-icon {
      font-size: 18px;
      height: 18px;
      width: 18px;
    }
  }

  .reset-button {
    color: var(--primary);
  }

  .apply-button {
    background-color: var(--accent);
    color: var(--text-on-accent);
  }

  @media (max-width: 576px) {
    flex-direction: column;

    button {
      width: 100%;
      justify-content: center;
    }
  }
}

// Section des filtres actifs
.active-filters {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  margin-top: var(--spacing-md);
  padding: var(--spacing-sm) var(--spacing-md);
  background-color: rgba(248, 249, 250, 0.5); // var(--background) with 50% opacity
  border-radius: var(--border-radius-medium);

  .active-filters-label {
    font-size: 14px; // Body Small size
    font-weight: 500; // Medium
    color: var(--primary);
    white-space: nowrap;
    letter-spacing: 0.1px; // From design guidelines
  }

  .active-filters-chips {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-sm);
    flex: 1;

    .active-filter-chip {
      background-color: rgba(90, 72, 245, 0.1); // var(--primary) with 10% opacity
      color: var(--primary);
      font-size: 12px; // Label size
      border-radius: var(--border-radius-large);
      letter-spacing: 0.5px; // From design guidelines

      ::ng-deep .mat-mdc-chip-remove {
        color: var(--primary);
        opacity: 0.7;

        &:hover {
          opacity: 1;
        }
      }
    }

    .clear-all-button {
      font-size: 12px; // Label size
      color: var(--accent);
      padding: 0 var(--spacing-sm);
      min-width: auto;
      letter-spacing: 0.5px; // From design guidelines

      &:hover {
        background-color: rgba(255, 170, 0, 0.05); // var(--accent) with 5% opacity
      }
    }
  }

  @media (max-width: 576px) {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm);
    margin-top: var(--spacing-sm);

    .active-filters-label {
      font-size: 13px;
      margin-bottom: 2px;
    }

    .active-filters-chips {
      width: 100%;

      .active-filter-chip {
        height: 28px;
        font-size: 11px;
      }

      .clear-all-button {
        height: 28px;
        line-height: 28px;
        font-size: 11px;
      }
    }
  }
}

// Utilitaires
.full-width {
  width: 100%;
}

// Animation de slide pour le masquage/affichage
@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-20px) scaleY(0.8);
  }
  to {
    opacity: 1;
    transform: translateY(0) scaleY(1);
  }
}

@keyframes slideUp {
  from {
    opacity: 1;
    transform: translateY(0) scaleY(1);
  }
  to {
    opacity: 0;
    transform: translateY(-20px) scaleY(0.8);
  }
}

.filters-container:not(.hidden) {
  animation: slideDown 0.4s ease-out;
}
