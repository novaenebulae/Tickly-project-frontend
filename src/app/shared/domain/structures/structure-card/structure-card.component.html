<div class="structure-card" [class.is-new]="highlightNewStructure">
  <div class="card-header">
    <!-- Image de couverture -->
    <div class="cover-container">
      <div class="structure-cover"
           [style.background-image]="'url(' + (structure.coverUrl || 'https://picsum.photos/1200/400?random=' + structure.id) + ')'">
        <div class="structure-importance" *ngIf="structure.importance !== undefined"
             [class]="getImportanceClass()"
             matTooltip="Score de popularité: {{structure.importance}}/100">
          <mat-icon>stars</mat-icon>
          <span>{{ getImportanceLabel() }}</span>
        </div>
      </div>
      <!-- Bouton de favoris positionné dans le coin supérieur droit -->
    </div>
    <!-- Bouton de favoris positionné dans le coin supérieur droit -->
    <div class="favorite-btn-container" *ngIf="showFavoriteButton">
      <button
        mat-icon-button
        class="favorite-btn"
        [class.is-favorite]="isFavorite"
        [matTooltip]="isFavorite ? 'Retirer des favoris' : 'Ajouter aux favoris'"
        (click)="onFavorite()">
        @if (isFavorite) {
          <mat-icon>favorite</mat-icon>
        } @else {
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed">
            <path
              d="m480-120-58-52q-101-91-167-157T150-447.5Q111-500 95.5-544T80-634q0-94 63-157t157-63q52 0 99 22t81 62q34-40 81-62t99-22q94 0 157 63t63 157q0 46-15.5 90T810-447.5Q771-395 705-329T538-172l-58 52Zm0-108q96-86 158-147.5t98-107q36-45.5 50-81t14-70.5q0-60-40-100t-100-40q-47 0-87 26.5T518-680h-76q-15-41-55-67.5T300-774q-60 0-100 40t-40 100q0 35 14 70.5t50 81q36 45.5 98 107T480-228Zm0-273Z"/>
          </svg>
        }
      </button>
    </div>
  </div>
  <div class="card-content">
    <div class="structure-info">
      <div class="content-header">
        <!-- En-tête avec nom et types -->
        <div class="structure-title">
          <h3>{{ structure.name }}</h3>
          <div class="structure-types">
            <mat-chip-set>
              <mat-chip *ngFor="let type of structure.types"
                        color="primary"
                        [matTooltip]="type.name || ''"
                        class="type-chip">
                {{ type.name }}
              </mat-chip>
            </mat-chip-set>
          </div>
          <div>
            <span class="structure-address">{{ structure.address.city }}</span>
          </div>
        </div>

        <!-- Logo à droite -->
        <div class="structure-logo" *ngIf="structure.logoUrl">
          <img [src]="structure.logoUrl" [alt]="structure.name + ' logo'"/>
        </div>
      </div>

      <!-- Description -->
      <div class="structure-description" *ngIf="structure.description">
        <p>
          {{ structure.description | slice:0:150 }}{{ structure.description && structure.description.length > 150 ? '...' : '' }}
        </p>
      </div>
    </div>

    <!-- Boutons d'action -->
    <div class="card-actions" *ngIf="showActions">
      <button mat-flat-button color="primary" class="action-btn details-btn" (click)="onViewDetails()">
        <mat-icon>visibility</mat-icon>
        Voir détails
      </button>
      <button mat-stroked-button color="accent" class="action-btn events-btn" [routerLink]="['/structures', structure.id, '/events']">
        <mat-icon>event</mat-icon>
        Événements
      </button>
    </div>
  </div>
</div>
