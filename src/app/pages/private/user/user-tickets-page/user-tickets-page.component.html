<div class="tickets-page">
  <div class="container">

    <!-- En-tête -->
    <div class="page-header">
      <h1>
        <mat-icon>confirmation_number</mat-icon>
        Mes billets
      </h1>
      <p class="page-description">
        Retrouvez tous vos billets d'événements, passés et à venir
      </p>
    </div>

    <!-- État de chargement -->
    <div class="loading-container" *ngIf="isLoading()">
      <mat-spinner></mat-spinner>
      <p>Chargement de vos billets...</p>
    </div>

    <!-- Contenu principal -->
    <div class="tickets-content" *ngIf="!isLoading()">

      <!-- Message si aucun billet -->
      <div class="no-tickets" *ngIf="allTickets().length === 0">
        <mat-icon>inbox</mat-icon>
        <h2>Aucun billet trouvé</h2>
        <p>Vous n'avez encore réservé aucun billet.</p>
        <button mat-raised-button color="primary" routerLink="/events">
          Découvrir les événements
        </button>
      </div>

      <!-- Onglets de billets -->
      <mat-tab-group *ngIf="allTickets().length > 0" class="tickets-tabs" dynamicHeight>

        <!-- Billets à venir -->
        <mat-tab [label]="'À venir (' + upcomingTickets().length + ')'">
          <div class="tab-content">
            <div class="tickets-grid" *ngIf="upcomingTickets().length > 0">
              <mat-card class="ticket-card"
                        *ngFor="let ticket of upcomingTickets()"
                        (click)="openTicketDetail(ticket)">
                <mat-card-header>
                  <div class="ticket-header">
                    <div class="event-image">
                      <img [src]="ticket.eventSnapshot.mainPhotoUrl"
                           [alt]="ticket.eventSnapshot.name"
                           *ngIf="ticket.eventSnapshot.mainPhotoUrl">
                      <mat-icon *ngIf="!ticket.eventSnapshot.mainPhotoUrl">event</mat-icon>
                    </div>
                    <div class="ticket-info">
                      <mat-card-title>{{ ticket.eventSnapshot.name }}</mat-card-title>
                      <mat-card-subtitle>
                        {{ formatEventDate(ticket.eventSnapshot.startDate) }}
                      </mat-card-subtitle>
                    </div>
                    <mat-chip [color]="getStatusColor(ticket.status)">
                      {{ getStatusLabel(ticket.status) }}
                    </mat-chip>
                  </div>
                </mat-card-header>

                <mat-card-content>
                  <div class="ticket-details">
                    <div class="detail-item">
                      <mat-icon>location_on</mat-icon>
                      <span>{{ ticket.eventSnapshot.address?.number || '' }} {{ ticket.eventSnapshot.address?.street || 'Adresse non disponible' }}</span>
                    </div>
                    <div class="detail-item">
                      <mat-icon>person</mat-icon>
                      <span>{{ ticket.participantInfo.firstName }} {{ ticket.participantInfo.lastName }}</span>
                    </div>
                    <div class="detail-item">
                      <mat-icon>theater_comedy</mat-icon>
                      <span>{{ ticket.audienceZoneSnapshot.name }}</span>
                    </div>
                  </div>
                </mat-card-content>

                <mat-card-actions>
                  <button mat-button color="primary">
                    <mat-icon>qr_code</mat-icon>
                    Voir le billet
                  </button>
                  <button mat-button>
                    <mat-icon>download</mat-icon>
                    Télécharger PDF
                  </button>
                </mat-card-actions>
              </mat-card>
            </div>

            <div class="empty-state" *ngIf="upcomingTickets().length === 0">
              <mat-icon>event_upcoming</mat-icon>
              <h3>Aucun événement à venir</h3>
              <p>Vous n'avez pas de billets pour des événements futurs.</p>
              <button mat-raised-button color="primary" routerLink="/events">
                Réserver des billets
              </button>
            </div>
          </div>
        </mat-tab>

        <!-- Billets passés -->
        <mat-tab [label]="'Passés (' + pastTickets().length + ')'">
          <div class="tab-content">
            <div class="tickets-grid" *ngIf="pastTickets().length > 0">
              <mat-card class="ticket-card past-ticket"
                        *ngFor="let ticket of pastTickets()"
                        (click)="openTicketDetail(ticket)">
                <mat-card-header>
                  <div class="ticket-header">
                    <div class="event-image">
                      <img [src]="ticket.eventSnapshot.mainPhotoUrl"
                           [alt]="ticket.eventSnapshot.name"
                           *ngIf="ticket.eventSnapshot.mainPhotoUrl">
                      <mat-icon *ngIf="!ticket.eventSnapshot.mainPhotoUrl">event</mat-icon>
                    </div>
                    <div class="ticket-info">
                      <mat-card-title>{{ ticket.eventSnapshot.name }}</mat-card-title>
                      <mat-card-subtitle>
                        {{ formatEventDate(ticket.eventSnapshot.startDate) }}
                      </mat-card-subtitle>
                    </div>
                    <mat-chip [color]="getStatusColor(ticket.status)">
                      {{ getStatusLabel(ticket.status) }}
                    </mat-chip>
                  </div>
                </mat-card-header>

                <mat-card-content>
                  <div class="ticket-details">
                    <div class="detail-item">
                      <mat-icon>person</mat-icon>
                      <span>{{ ticket.participantInfo.firstName }} {{ ticket.participantInfo.lastName }}</span>
                    </div>
                    <div class="detail-item">
                      <mat-icon>theater_comedy</mat-icon>
                      <span>{{ ticket.audienceZoneSnapshot.name }}</span>
                    </div>
                    <div class="detail-item" *ngIf="ticket.usedAt">
                      <mat-icon>access_time</mat-icon>
                      <span>Utilisé le {{ ticket.usedAt | date:'short' }}</span>
                    </div>
                  </div>
                </mat-card-content>

                <mat-card-actions>
                  <button mat-button>
                    <mat-icon>visibility</mat-icon>
                    Voir les détails
                  </button>
                  <button mat-button>
                    <mat-icon>download</mat-icon>
                    Télécharger PDF
                  </button>
                </mat-card-actions>
              </mat-card>
            </div>

            <div class="empty-state" *ngIf="pastTickets().length === 0">
              <mat-icon>history</mat-icon>
              <h3>Aucun événement passé</h3>
              <p>Vous n'avez pas encore assisté à d'événements.</p>
            </div>
          </div>
        </mat-tab>

        <!-- Billets annulés -->
        <mat-tab [label]="'Annulés (' + cancelledTickets().length + ')'" *ngIf="cancelledTickets().length > 0">
          <div class="tab-content">
            <div class="tickets-grid">
              <mat-card class="ticket-card cancelled-ticket"
                        *ngFor="let ticket of cancelledTickets()"
                        (click)="openTicketDetail(ticket)">
                <mat-card-header>
                  <div class="ticket-header">
                    <div class="event-image">
                      <img [src]="ticket.eventSnapshot.mainPhotoUrl"
                           [alt]="ticket.eventSnapshot.name"
                           *ngIf="ticket.eventSnapshot.mainPhotoUrl">
                      <mat-icon *ngIf="!ticket.eventSnapshot.mainPhotoUrl">event</mat-icon>
                    </div>
                    <div class="ticket-info">
                      <mat-card-title>{{ ticket.eventSnapshot.name }}</mat-card-title>
                      <mat-card-subtitle>
                        {{ formatEventDate(ticket.eventSnapshot.startDate) }}
                      </mat-card-subtitle>
                    </div>
                    <mat-chip [color]="getStatusColor(ticket.status)">
                      {{ getStatusLabel(ticket.status) }}
                    </mat-chip>
                  </div>
                </mat-card-header>

                <mat-card-content>
                  <div class="ticket-details">
                    <div class="detail-item">
                      <mat-icon>person</mat-icon>
                      <span>{{ ticket.participantInfo.firstName }} {{ ticket.participantInfo.lastName }}</span>
                    </div>
                    <div class="detail-item">
                      <mat-icon>theater_comedy</mat-icon>
                      <span>{{ ticket.audienceZoneSnapshot.name }}</span>
                    </div>
                  </div>
                </mat-card-content>

                <mat-card-actions>
                  <button mat-button>
                    <mat-icon>visibility</mat-icon>
                    Voir les détails
                  </button>
                </mat-card-actions>
              </mat-card>
            </div>
          </div>
        </mat-tab>

      </mat-tab-group>
    </div>
  </div>
</div>
