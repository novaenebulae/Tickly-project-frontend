<div class="container-fluid py-4">
  <!-- Section En-tête -->
  <mat-card class="mat-elevation-z2 mb-4">
    <mat-card-content
      class="d-flex flex-column justify-content-between align-items-start flex-wrap p-4"
    >
      <h1 class="mat-headline-3">Gestion des Zones</h1>
      <p class="mat-body-3 text-muted w-70">
        Ajoutez, modifiez ou supprimez les différentes zones (scènes, bars,
        gradins...) de votre structure. Les zones inactives ne pourront pas être
        utilisées lors de la création d'événements.
      </p>
    </mat-card-content>
  </mat-card>

  <!-- Card contenant le filtre et le tableau -->
  <mat-card class="mat-elevation-z2">
    <mat-card-content class="p-4 my-3">
      <!-- Section Filtre -->
      <div class="border-bottom">
        <div class="row align-items-stretch mb-4">
          <div class="col">
            <mat-form-field
              appearance="outline"
              class="w-100 filter-field mb-0"
              subscriptSizing="dynamic"
            >
              <mat-label>Rechercher une zone...</mat-label>
              <mat-icon matPrefix class="icon-muted me-2">search</mat-icon>
              <input
                matInput
                (keyup)="applyFilter($event)"
                placeholder="Nom, capacité..."
                #filterInput
              />
              <!-- Bouton pour effacer le filtre, s'affiche seulement si l'input a une valeur -->
              @if (filterInput.value) {
              <button
                mat-icon-button
                matSuffix
                (click)="clearFilter()"
                aria-label="Vider le filtre"
                matTooltip="Effacer la recherche"
              >
                <mat-icon>close</mat-icon>
              </button>
              }
            </mat-form-field>
          </div>
          <div class="col-12 col-md-auto d-flex">
            <button
              mat-raised-button
              color="primary"
              (click)="openZoneDialog()"
              class="flex-grow-1 flex-md-grow-0"
            >
              <mat-icon>add_circle_outline</mat-icon>
              Ajouter une Zone
            </button>
          </div>
        </div>
      </div>

      <!-- Tableau des zones -->
      <div class="table-responsive px-4 my-4">
        <table
          mat-table
          [dataSource]="dataSource"
          matSort
          class="w-100 zone-table"
          aria-label="Tableau des zones"
        >
          <!-- Colonne Nom -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header scope="col">
              Nom
            </th>
            <td mat-cell *matCellDef="let zoneItem" data-label="Nom:">
              <span class="fw-medium">{{ zoneItem.name }}</span>
            </td>
          </ng-container>

          <!-- Colonne Capacité Max -->
          <ng-container matColumnDef="maxCapacity">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="text-right"
              scope="col"
            >
              Capacité Max.
            </th>
            <td
              mat-cell
              *matCellDef="let zoneItem"
              class="text-right"
              data-label="Capacité:"
            >
              {{ zoneItem.maxCapacity | number }}
            </td>
          </ng-container>

          <!-- Colonne Statut (Activé/Désactivé) -->
          <ng-container matColumnDef="status">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-center"
              scope="col"
            >
              Statut
            </th>
            <td
              mat-cell
              *matCellDef="let zoneItem"
              class="text-center w-0"
              data-label="Statut:"
            >
              <mat-slide-toggle
                color="primary"
                [checked]="zoneItem.isActive"
                (change)="toggleZoneStatus(zoneItem, $event)"
                aria-label="Activer ou désactiver la zone"
                matTooltip="{{
                  zoneItem.isActive ? 'Désactiver la zone' : 'Activer la zone'
                }}"
              >
              </mat-slide-toggle>
              <!-- Texte optionnel masqué sur petit écran -->
              <span class="ms-2 d-none d-sm-inline-block align-middle">{{
                zoneItem.isActive ? "Activée" : "Désactivée"
              }}</span>
            </td>
          </ng-container>

          <!-- Colonne Actions (Modifier/Supprimer) -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="text-end" scope="col">
              Actions
            </th>
            <td
              mat-cell
              *matCellDef="let zoneItem"
              class="text-end"
              data-label="Actions:"
            >
              <button
                mat-icon-button
                color="primary"
                (click)="openZoneDialog(zoneItem)"
                matTooltip="Modifier la zone"
                aria-label="Modifier la zone"
              >
                <mat-icon>edit</mat-icon>
              </button>
              <button
                mat-icon-button
                color="warn"
                (click)="deleteZone(zoneItem)"
                matTooltip="Supprimer la zone"
                aria-label="Supprimer la zone"
              >
                <mat-icon>delete_outline</mat-icon>
              </button>
            </td>
          </ng-container>

          <!-- Définition des lignes d'en-tête et de données -->
          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns; sticky: true"
          ></tr>
          <tr
            mat-row
            class="zone-row"
            *matRowDef="let row; columns: displayedColumns"
          ></tr>

          <!-- Ligne affichée si aucune donnée après filtrage -->
          <tr class="mat-row" *matNoDataRow>
            <td
              class="mat-cell text-center p-4 text-muted"
              [attr.colspan]="displayedColumns.length"
            >
              Aucune zone trouvée @if(filterInput.value){ pour votre recherche
              }.
            </td>
          </tr>
        </table>
      </div>

    </mat-card-content>
  </mat-card>
</div>
